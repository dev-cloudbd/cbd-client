<!doctype refentry PUBLIC "-//OASIS//DTD DocBook V4.1//EN" [

<!-- Process this file with docbook-to-man to generate an nroff manual
     page: `docbook-to-man manpage.sgml > manpage.1'.  You may view
     the manual page with: `docbook-to-man manpage.sgml | nroff -man |
     less'.  A typical entry in a Makefile or Makefile.am is:

manpage.1: manpage.sgml
	docbook-to-man $< > $@
  -->

  <!-- Fill in your name for FIRSTNAME and SURNAME. -->
  <!ENTITY dhfirstname "<firstname>Shaun</firstname>">
  <!ENTITY dhsurname   "<surname>McDowell</surname>">
  <!-- Please adjust the date whenever revising the manpage. -->
  <!ENTITY dhdate      "<date>$Date: 2018-11-17 15:00:00 -0500 $</date>">
  <!-- SECTION should be 1-8, maybe w/ subsection other parameters are
       allowed: see man(7), man(1). -->
  <!ENTITY dhsection   "<manvolnum>5</manvolnum>">
  <!ENTITY dhemail     "<email>smcdowell@cloudbd.io</email>">
  <!ENTITY dhusername  "Shaun McDowell">
  <!ENTITY dhucpackage "<refentrytitle>CBDTAB</refentrytitle>">
  <!ENTITY dhpackage   "$sysconfdir/cloudbd/cbdtab">
]>

<refentry>
  <refentryinfo>
    <address>
      &dhemail;
    </address>
    <author>
      &dhfirstname;
      &dhsurname;
    </author>
    <copyright>
      <year>2018</year>
      <holder>CloudBD, LLC</holder>
    </copyright>
    &dhdate;
  </refentryinfo>
  <refmeta>
    &dhucpackage;

    &dhsection;
  </refmeta>
  <refnamediv>
    <refname>&dhpackage;</refname>

    <refpurpose>configuration file for CloudBD disks</refpurpose>
  </refnamediv>
  <refsynopsisdiv>
    <cmdsynopsis>
      <command>&dhpackage; </command>

    </cmdsynopsis>
  </refsynopsisdiv>
  <refsect1>
    <title>DESCRIPTION</title>

    <para>This file configures which CloudBD disks attach to this
      server. It may contain multiple disk definitions, one per line,
      each of which contains three space separate fields.</para>

    <para>Fields are separated from one another by any number of space
      or tab characters; disk definitions are separated from one another by
      newline characters. The file may also contain any number of
      comments, which start with a '#' character and continue until the
      end of the line or the end of the file, whichever is first.</para>

    <refsect2>
      <title>Fields</title>
      <para>Each disk definition contains the following fields: &lt;nbd&gt;,
        &lt;remote&gt;:&lt;disk&gt;, and [driver settings]</para>
      <orderedlist>
        <listitem>
          <para>&lt;nbd&gt;  The short name of an available nbd device.</para>
          <para>The default nbd kernel module settings will create 16 nbd
            devices at <filename>/dev/nbd[0-15]</filename>. This field should
            contain the short name of an unused nbd device without the leading
            <filename>/dev/</filename> part; e.g., it could say
            <filename>nbd0</filename>.</para>
        </listitem>
        <listitem>
          <para>&lt;remote&gt;:&lt;disk&gt;  The remote and disk names.</para>
          <para>The remote name is the filename of your storage remote config file
            in the remotes.d directory without the '.conf' extension; e.g.,
            <filename>/etc/cloudbd/remotes.d/&lt;remote&gt;.conf</filename>.
            For a list of configured remotes run <command>cloudbd
            ls</run>.</para>
          <para>The disk name is the name of a CloudBD disk stored on
            &lt;remote&gt;. For a list of disks on the remote run
            <command>cloudbd ls &lt;remote&gt;</command>.</para>
        </listitem>
        <listitem>
          <para>[driver settings]  The driver settings.</para>
          <para>This field is optional and need not appear in a file if no
            driver tuning is necessary. The settings recognized are
            specified below in the section "Driver Settings".</para>
        </listitem>
      </orderedlist>
    </refsect2>
    <refsect2>
      <title>Driver Settings</title>
      <variablelist>
        <varlistentry>
          <term><option>defaults</option></term>
          <listitem>
            <para>The default settings. Recommended for servers with
            up to 10 gigabit networking and at least 4 GB of memory.</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><option>lowmem</option></term>
          <listitem>
            <para>Reduced memory and network usage. Recommended for servers
              with up to 5 Gigabit networking and at least 2GB of
              memory.</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><option>highperf|highmem</option></term>
          <listitem>
            <para>Increased buffers and connections for high performance
              (2GiB/s+). Recommended for servers with up to 25 Gigabit
              networking and at least 8GB of memory.</para>
          </listitem>
        </varlistentry>
    </refsect2>
    <refsect2>
      <title>Upstart/SysVinit</title>

      <para>On systems using Upstart or SysVinit, CloudBD disks specified in
        <filename>cbdtab</filename> are automatically started at boot time by the
        cbddisks service. Started disks are available as a block device at
        <filename>/dev/mapper/&lt;remote&gt;:&lt;disk&gt;</filename>.</para>

      <para>To start all CloudBD disks specified in
        <filename>cbdtab</filename>, run
        <command>service cbddisks start</command>.</para>

      <para>To stop all running CloudBD disks, run
        <command>service cbddisks stop</command>.</para>

      <para>To start a specific CloudBD disk from the cbdtab file, run
        <command>cbddisks_start</command> with the &lt;remote&gt;:&lt;disk&gt;
        as the sole argument.</para>

      <para>To stop a running CloudBD disk, run
        <command>cbddisks_stop</command> with the &lt;remote&gt;:&lt;disk&gt;
        as the sole argument. If the disk is busy or in use, use the -f option
        to force the disk to stop.</para>
    </refsect2>
    <refsect2>
      <title>Systemd</title>

      <para>On systems using Systemd, CloudBD disks specified in
        <filename>cbdtab</filename> are automatically started at boot by
        generated service files for each disk and the
        <filename>cbdsetup.target</filename>. Started disks are available as
        a block device at
        <filename>/dev/mapper/&lt;remote&gt;:&lt;disk&gt;</filename>.</para>

      <para>When editing the <filename>cbdtab</filename> file, you must run
        <command>systemctl daemon-reload</command> afterwards to update the
        generated systemd service files for your disks.</para>

      <para>To start all CloudBD disks specified in
        <filename>cbdtab</filename>, run <command>systemctl start
        cbdsetup.target</command> or <command>systemctl start
        cbdsetup@*.service</command>.</para>

      <para>To stop all running CloudBD disks, run
        <command>systemctl stop cbdsetup@*.service</command>.</para>

      <para>To start an individual CloudBD disk specified in
        <filename>cbdtab</filename>, run <command>systemctl start
        cbdsetup@&lt;remote&gt;:&lt;disk&gt;.service</command>.</para>

      <para>To stop an individual running CloudBD disk, run <command>systemctl
        stop cbdsetup@&lt;remote&gt;:&lt;disk&gt;.service</command>.</para>
    </refsect2>
  </refsect1>
  <refsect1>
    <title>SEE ALSO</title>

    <para>The CloudBD documentation pages at
      https://www.cloudbd.io/docs.</para>

  </refsect1>
  <refsect1>
    <title>AUTHOR</title>

    <para>This manual page was written by &dhusername; (&dhemail;).
      Permission is granted to copy, distribute and/or modify this
      document under the terms of the <acronym>GNU</acronym> General
      Public License, version 2, as published by the Free Software
      Foundation.</para>

  </refsect1>
  <refsect1>
    <title>EXAMPLES</title>
    <para>A simple <filename>cbdtab</filename> file could look like
    this:</para>
    <programlisting>
# &lt;nbd&gt;     &lt;remote&gt;:&lt;disk&gt;             [driver settings]
nbd0        my_remote_1:example_disk1   # no options set, will use defaults
nbd1        my_remote_1:example_disk2   lowmem   # reduced settings
nbd2        my_remote_2:example_disk3   highperf # high performance settings
nbd3        my_remote_2:example_disk4   defaults # use default settings
    </programlisting>
  </refsect1>
</refentry>
